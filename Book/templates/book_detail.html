{% extends 'base.html' %}
{% block content %}
<div style="display: flex; gap: 40px; margin-top: 20px;">

  <!-- Left: Book Image -->
  <div style="width: 30%;">
    <img src="{{ book.image.url }}" alt="{{ book.title }}" style="width: 100%; max-width: 300px;" />
  </div>

  <!-- Right: Book Details and Reviews -->
  <div style="width: 70%;">
    <h1>{{ book.title }}</h1>
    <p style="margin-top: 10px;">{{ book.description }}</p>

    {% if user.is_authenticated %}
    <!-- Add Review -->
    <div style="margin-top: 20px;">
      <h3>Add Review</h3>
      <form method="POST" action="{% url 'add_review' book.id %}">
        {% csrf_token %}
        <textarea name="content" rows="4" style="width: 100%;" required></textarea><br>
        <button type="submit" style="margin-top: 10px;">Submit Review</button>
      </form>
    </div>

    <!-- Borrow Book -->
    <div style="margin-top: 20px;">
      <h3>Borrow Book</h3>
      <form method="POST" action="{% url 'borrow_book' book.id %}">
        {% csrf_token %}
        <label>Select Duration:</label>
        <select name="duration" required>
          <option value="1 Week">1 Week</option>
          <option value="15 Days">15 Days</option>
        </select>
        <button type="submit" style="margin-left: 10px;">Borrow</button>
      </form>
    </div>
    {% else %}
    <p style="margin-top: 20px;"><a href="{% url 'login' %}">Login</a> to review or borrow this book.</p>
    {% endif %}

    <!-- All Reviews -->
    <div style="margin-top: 30px;">
      <h2>Reviews</h2>
      {% for review in reviews %}
        <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 15px;">
          <p><strong>{{ review.user.username }}</strong> ({{ review.created_at|date:'Y-m-d' }})</p>
          <p>{{ review.content }}</p>
          {% if request.user == review.user %}
            <a href="{% url 'edit_review' review.id %}">Edit</a> |
            <a href="{% url 'delete_review' review.id %}">Delete</a>
          {% endif %}
        </div>
      {% empty %}
        <p>No reviews yet.</p>
      {% endfor %}
    </div>

  </div>
</div>
{% endblock %}